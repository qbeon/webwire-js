!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports["webwire-js"]=r():e["webwire-js"]=r()}(this,function(){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=15)}([function(e,r,t){"use strict";t.d(r,"b",function(){return n}),t.d(r,"a",function(){return o});var n={AcceptConf:23,ErrorReply:0,ReplyShutdown:1,ReplyInternalError:2,SessionNotFound:3,MaxSessConnsReached:4,SessionsDisabled:5,ReplyProtocolError:6,SessionCreated:21,SessionClosed:22,CloseSession:31,RestoreSession:32,Heartbeat:33,SignalBinary:63,SignalUtf8:64,SignalUtf16:65,RequestBinary:127,RequestUtf8:128,RequestUtf16:129,ReplyBinary:191,ReplyUtf8:192,ReplyUtf16:193},o={AcceptConf:11,Signal:3,SignalUtf16:4,Request:11,RequestUtf16:12,Reply:9,ReplyUtf16:10,ErrorReply:11,ReplyShutdown:9,ReplyInternalError:9,SessionNotFound:9,MaxSessConnsReached:9,SessionsDisabled:9,ReplyProtocolError:9,RestoreSession:10,CloseSession:9,SessionCreated:2,SessionClosed:1}},function(e,r,t){e.exports=t(16)},function(e,r,t){"use strict";function n(e){var r,t,n,o,a,i;for(r="",n=e.length,t=0;t<n;)switch((o=e[t++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(o);break;case 12:case 13:a=e[t++],r+=String.fromCharCode((31&o)<<6|63&a);break;case 14:a=e[t++],i=e[t++],r+=String.fromCharCode((15&o)<<12|(63&a)<<6|(63&i)<<0)}return r}t.d(r,"a",function(){return n})},function(e,r,t){"use strict";function n(e){var r;r=new ArrayBuffer(e.length);for(var t=new Uint8Array(r),n=0;n<e.length;n++){var o=e.charCodeAt(n);if(o<32||o>126)throw new Error("Unsupported session key character (".concat(o,")"));t[n]=o}Object.defineProperty(this,"bytes",{get:function(){return t}}),Object.defineProperty(this,"string",{get:function(){return e}})}t.d(r,"a",function(){return n})},function(e,r,t){"use strict";t.d(r,"a",function(){return o});var n=new a(0,0);function o(){n.increment();var e=n.frags;return new a(e.front,e.end)}function a(e,r){var t=new ArrayBuffer(8),n=new Uint32Array(t,0,2);n.set([e,r],0),Object.defineProperty(this,"frags",{get:function(){return{front:n[0],end:n[1]}}}),Object.defineProperty(this,"bytes",{get:function(){return new Uint8Array(t)}}),Object.defineProperty(this,"increment",{value:function(){var e=n[0],r=n[1];r+1>4294967295?(e+1>4294967295&&(r=0,e=0),r=0,e++):r++,n.set([e,r],0)}})}},function(e,r,t){"use strict";function n(e){for(var r=[],t=0;t<e.length;t++){var n=e.charCodeAt(t);n<128?r.push(n):n<2048?r.push(192|n>>6,128|63&n):n<55296||n>=57344?r.push(224|n>>12,128|n>>6&63,128|63&n):(t++,n=65536+((1023&n)<<10|1023&e.charCodeAt(t)),r.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return r}t.d(r,"a",function(){return n})},function(e,r){var t,n,o=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var s,u=[],l=!1,f=-1;function p(){l&&s&&(l=!1,s.length?u=s.concat(u):f=-1,u.length&&h())}function h(){if(!l){var e=c(p);l=!0;for(var r=u.length;r;){for(s=u,u=[];++f<r;)s&&s[f].run();f=-1,r=u.length}s=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(r){try{return n.call(null,e)}catch(r){return n.call(this,e)}}}(e)}}function d(e,r){this.fun=e,this.array=r}function y(){}o.nextTick=function(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)r[t-1]=arguments[t];u.push(new d(e,r)),1!==u.length||l||c(h)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,r,t){"use strict";(function(e){var n=t(2),o=t(11),a=t(0);function i(e,r){if(r.length<1)return{err:new Error("Invalid message, too short")};var t,i="binary",c=r[0];switch(c){case a.b.AcceptConf:t=function(e,r){if(r.length<a.a.AcceptConf)return{err:new Error("Invalid accept-conf message, too short"+"(".concat(r.length," / ").concat(a.a.ReplyUtf16,")"))};var t=new DataView(e);return{majorProtocolVersion:r[1],minorProtocolVersion:r[2],readTimeout:t.getUint32(3,!0),messageBufferSize:t.getUint32(7,!0),subProtocolName:r.length>a.a.AcceptConf?Object(n.a)(r.subarray(11)):null}}(e,r);break;case a.b.SessionCreated:t=function(e){return e.length<a.a.SessionCreated?{err:new Error("Invalid session creation notification message, "+"too short (".concat(e.length," / ").concat(a.a.SessionCreated,")"))}:{session:JSON.parse(Object(n.a)(e.subarray(1)))}}(r);break;case a.b.SessionClosed:t=function(e){return e.length!==a.a.SessionClosed?{err:new Error("Invalid session closure notification message")}:{}}(r);break;case a.b.SignalBinary:t=function(e){if(e.length<a.a.Signal)return{err:new Error("Invalid signal (Binary) message, too short "+"(".concat(e.length," / ").concat(a.a.Signal,")"))};var r=e.subarray(1,2)[0],t=2+r;return e.length<a.a.Signal+r?{err:new Error("Invalid signal (Binary) message, too short for full name"+"(".concat(r,") and the minimum payload (1)"))}:r>0?{name:String.fromCharCode.apply(null,e.subarray(2,t)),payload:e.subarray(t)}:{payload:e.subarray(2)}}(r);break;case a.b.SignalUtf8:i="utf8",t=function(e){if(e.length<a.a.Signal)return{err:new Error("Invalid signal (UTF8) message, too short "+"(".concat(e.length," / ").concat(a.a.Signal,")"))};var r=e.subarray(1,2)[0],t=2+r;return e.length<a.a.Signal+r?{err:new Error("Invalid signal (UTF8) message, "+"too short for full name (".concat(r,") ")+"and the minimum payload (1)")}:r>0?{name:String.fromCharCode.apply(null,e.subarray(2,t)),payload:Object(n.a)(e.subarray(t))}:{payload:Object(n.a)(e.subarray(2))}}(r);break;case a.b.SignalUtf16:i="utf16",t=function(e){if(e.length<a.a.SignalUtf16)return{err:new Error("Invalid signal (UTF16) message, too short "+"(".concat(e.length," / ").concat(a.a.SignalUtf16,")"))};if(e.length%2!=0)return{err:new Error("Unaligned UTF16 encoded signal message "+"(length: ".concat(e.length,", probably missing header padding)"))};var r=e.subarray(1,2)[0],t=a.a.SignalUtf16+r,n=2+r;return r%2!=0&&(t++,n++),e.length<t?{err:new Error("Invalid signal (UTF16) message, too short for full name "+"(".concat(r,") and the minimum payload (2)"))}:r>0?{name:String.fromCharCode.apply(null,new Uint8Array(e,2,2+r)),payload:String.fromCharCode.apply(null,new Uint16Array(e.subarray(n)))}:{payload:String.fromCharCode.apply(null,new Uint16Array(e.subarray(2)))}}(r);break;case a.b.ReplyShutdown:t=function(e){if(e.length<a.a.ReplyShutdown)return{err:new Error("Invalid shutdown error message, too short "+"(".concat(e.length," / ").concat(a.a.ReplyShutdown,")"))};var r=new Error("Server is currently being shutdown and won't process the request");return r.errType="shutdown",{id:e.subarray(1,9),reqError:r}}(r);break;case a.b.ReplyInternalError:t=function(e){if(e.length<a.a.ReplyInternalError)return{err:new Error("Invalid internal error message, too short "+"(".concat(e.length," / ").concat(a.a.ReplyInternalError,")"))};var r=new Error("Request failed due to an internal server error");return r.errType="internal",{id:e.subarray(1,9),reqError:r}}(r);break;case a.b.SessionNotFound:t=function(e){if(e.length<a.a.SessionNotFound)return{err:new Error("Invalid session not found error message, too short "+"(".concat(e.length," / ").concat(a.a.SessionNotFound,")"))};var r=new Error("Requested session wasn't found");return r.errType="session_not_found",{id:e.subarray(1,9),reqError:r}}(r);break;case a.b.MaxSessConnsReached:t=function(e){if(e.length<a.a.MaxSessConnsReached)return{err:new Error("Invalid max-session-connections-reached error message, too short "+"(".concat(e.length," / ").concat(a.a.MaxSessConnsReached,")"))};var r=new Error("Maximum concurrent connections reached for requested session");return r.errType="max_sess_conns_reached",{id:e.subarray(1,9),reqError:r}}(r);break;case a.b.SessionsDisabled:t=function(e){if(e.length<a.a.SessionsDisabled)return{err:new Error("Invalid sessions disabled message, too short "+"(".concat(e.length," / ").concat(a.a.SessionsDisabled,")"))};var r=new Error("Sessions are disabled for this server");return r.errType="sessions_disabled",{id:e.subarray(1,9),reqError:r}}(r);break;case a.b.ErrorReply:t=function(e){if(e.length<a.a.ErrorReply)return{err:new Error("Invalid error reply message, too short "+"(".concat(e.length," / ").concat(a.a.ErrorReply,")"))};var r=e.subarray(9,10)[0];if(r<1)return{err:new Error("Invalid error code length in error reply message")};if(e.length<a.a.ErrorReply+r-1)return{err:new Error("Invalid error reply message, "+"too short for error code (".concat(r,")"))};var t=new Error(Object(n.a)(e.subarray(10+r)));return t.code=Object(o.a)(e.subarray(10,10+r)),{id:e.subarray(1,9),reqError:t}}(r);break;case a.b.ReplyProtocolError:t=function(e){if(e.length<a.a.ReplyProtocolError)return{err:new Error("Invalid protocol error reply message, too short: "+"(".concat(e.length," / ").concat(a.a.ReplyProtocolError,")"))};var r=new Error("Protocol error");return r.errType="protocol_error",{id:e.subarray(1,9),reqError:r}}(r);break;case a.b.ReplyBinary:t=function(e){if(e.length<a.a.Reply)return{err:new Error("Invalid reply (Binary) message, too short "+"(".concat(e.length," / ").concat(a.a.Reply,")"))};var r=null;return e.length>a.a.Reply&&(r=e.subarray(9)),{id:e.subarray(1,9),payload:r}}(r);break;case a.b.ReplyUtf8:i="utf8",t=function(e){if(e.length<a.a.Reply)return{err:new Error("Invalid reply (UTF8) message, too short "+"(".concat(e.length," / ").concat(a.a.Reply,")"))};var r=null;return e.length>a.a.Reply&&(r=Object(n.a)(e.subarray(9))),{id:e.subarray(1,9),payload:r}}(r);break;case a.b.ReplyUtf16:i="utf16",t=function(e){if(e.length<a.a.ReplyUtf16)return{err:new Error("Invalid reply (UTF16) message, too short "+"(".concat(e.length," / ").concat(a.a.ReplyUtf16,")"))};if(e.length%2!=0)return{err:new Error("Unaligned UTF16 encoded reply message "+"(length: ".concat(e.length,", probably missing header padding)"))};var r=null;return e.length>a.a.ReplyUtf16&&(r=String.fromCharCode.apply(null,new Uint16Array(e,10,e.length-5))),{id:e.subarray(1,9),payload:r}}(r);break;default:t={err:new Error("Unsupported message type: ".concat(c))}}return null!=t.err?{err:t.err}:{type:c,payloadEncoding:i,msg:t}}r.a=function(r){return new Promise(function(t,n){try{if(e.browser){var o=new FileReader;o.onerror=function(e){n(e.target.error)},o.onload=function(){t(i(this.result,new Uint8Array(this.result)))},o.readAsArrayBuffer(r)}else t(i(r.buffer,new Uint8Array(r.buffer,r.byteOffset,r.byteLength/Uint8Array.BYTES_PER_ELEMENT)))}catch(e){n(e)}})}}).call(this,t(6))},function(e,r,t){(function(r){r.browser?e.exports=function(e){var r=new WebSocket(e);Object.defineProperty(this,"onOpen",{value:function(e){r.onopen=e},writable:!1}),Object.defineProperty(this,"onError",{value:function(e){r.onerror=e},writable:!1}),Object.defineProperty(this,"onMessage",{value:function(e){r.onmessage=function(r){return e(r.data)}},writable:!1}),Object.defineProperty(this,"onClose",{value:function(e){r.onclose=function(r){return e(r.code)}},writable:!1}),Object.defineProperty(this,"send",{value:function(e){r.send(e)},writable:!1})}:e.exports=function(e){var r=new WebSocket(e);Object.defineProperty(this,"onOpen",{value:function(e){r.on("open",e)},writable:!1}),Object.defineProperty(this,"onError",{value:function(e){},writable:!1}),Object.defineProperty(this,"onMessage",{value:function(e){r.on("message",e)},writable:!1}),Object.defineProperty(this,"onClose",{value:function(e){r.on("close",e)},writable:!1}),Object.defineProperty(this,"send",{value:function(e){r.send(e)},writable:!1})}}).call(this,t(6))},function(e,r,t){"use strict";t.d(r,"a",function(){return c});var n=t(0),o=t(4),a=t(5);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,r,t){if(null==r)throw new Error("Missing request payload");if(null==e&&(e=""),e.length>255)throw new Error("Request name too long (".concat(e.length,"), max 255"));var c,s=Object(o.a)();if("string"==typeof r&&"utf8"===t)c=function(e,r,t){var o=Object(a.a)(t),i=10+r.length,c=new ArrayBuffer(i+o.length),s=new Uint8Array(c,0,i);s[0]=n.b.RequestUtf8;for(var u=e.bytes,l=1;l<9;l++)s[l]=u[l-1];s[9]=r.length;for(var f=0;f<r.length;f++){var p=r.charCodeAt(f);if(p<32||p>126)throw new Error("Unsupported name character (".concat(p,")"));s[10+f]=r.charCodeAt(f)}for(var h=new Uint8Array(c,i,o.length),d=0;d<o.length;d++)h[d]=o[d];return c}(s,e,r);else{if("string"!=typeof r||null!=t)throw new Error("Unsupported request payload type: ".concat(i(r)));c=function(e,r,t){var o=0;null!=r&&r.length%2!=0&&(o=1);var a=10+r.length+o,i=new ArrayBuffer(a+2*t.length),c=new Uint8Array(i,0,a);c[0]=n.b.RequestUtf16;for(var s=e.bytes,u=1;u<9;u++)c[u]=s[u-1];c[9]=r.length;for(var l=0;l<r.length;l++){var f=r.charCodeAt(l);if(f<32||f>126)throw new Error("Unsupported name character (".concat(f,")"));c[10+l]=r.charCodeAt(l)}for(var p=new Uint16Array(i,a,t.length),h=0;h<t.length;h++)p[h]=t.charCodeAt(h);return i}(s,e,r)}Object.defineProperty(this,"bytes",{get:function(){return new Uint8Array(c)}}),Object.defineProperty(this,"id",{get:function(){return s}})}},function(e,r,t){"use strict";t.d(r,"a",function(){return i});var n=t(0),o=t(5);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,r,t){if(null==e&&(e=""),null==r)throw new Error("Missing signal payload");var i;if("string"==typeof r&&"utf8"===t){var c=Object(o.a)(r),s=2+e.length;i=new ArrayBuffer(s+c.length);var u=new Uint8Array(i,0,s);u[0]=n.b.SignalUtf8,u[1]=e.length;for(var l=0;l<e.length;l++)u[2+l]=e.charCodeAt(l);for(var f=new Uint8Array(i,s,c.length),p=0;p<c.length;p++)f[p]=c[p]}else{if("string"!=typeof r||null!=t)throw new Error("Unsupported signal payload type: ".concat(a(r)));var h=!1;e.length%2!=0&&(h=!0);var d=2+e.length+(h?1:0);i=new ArrayBuffer(d+2*r.length);var y=new Uint8Array(i,0,d);y[0]=n.b.SignalUtf16,y[1]=e.length;for(var b=0;b<e.length;b++)y[2+b]=e.charCodeAt(b);for(var g=new Uint16Array(i,d,r.length),v=0;v<r.length;v++)g[v]=r.charCodeAt(v)}Object.defineProperty(this,"bytes",{get:function(){return new Uint8Array(i)}})}},function(e,r,t){"use strict";function n(e){for(var r="",t=0;t<e.length;t++)r+=String.fromCharCode(e[t]);return r}t.d(r,"a",function(){return n})},function(e,r,t){"use strict";t.d(r,"a",function(){return a});var n=t(4);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,r){if(null==e||e<0||e>255)throw new Error("Missing or invalid message type ".concat(e));if(null!=r&&!(r instanceof Uint8Array))throw new Error("Invalid request payload: ".concat(o(r)));var t=null!=r?r.length:0,a=new ArrayBuffer(9+t),i=new Uint8Array(a,0,9+t);i[0]=e;for(var c=Object(n.a)(),s=c.bytes,u=1;u<9;u++)i[u]=s[u-1];if(null!=r)for(var l=0;l<t;l++)i[9+l]=r[l];Object.defineProperty(this,"bytes",{get:function(){return new Uint8Array(a)}}),Object.defineProperty(this,"id",{get:function(){return c}})}},function(e,r,t){"use strict";var n=/^((http|https):\/\/)?(localhost|((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){3}((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9]))(:([0-9]{1,4}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5]))?\/*(\/([^/]+)\/?.*$)?$/;r.a=function(e){if("string"!=typeof e||e.length<1)throw new Error("Invalid WebWire server host");return function(e){var r=n.exec(e);if(null==r)throw new Error("Invalid server host string: ".concat(e));var t=r[2]||"http",o=r[3],a=parseInt(r[13]||80),i=r[14];return"https"===t&&null==r[13]&&(a=443),{protocol:t,hostname:o,port:a,path:i}}(e)}},function(e,r,t){"use strict";t.d(r,"a",function(){return o});var n=2;function o(e,r){if(e!==n){var t=new Error("Unsupported protocol version: ".concat(e,".").concat(r," ")+"(supported: ".concat(n,".0)"));return t.errType="incompatibleProtocolVersion",t}}},function(e,r,t){"use strict";t.r(r),function(e){t.d(r,"default",function(){return v});var n=t(1),o=t.n(n),a=t(8),i=t.n(a),c=t(0),s=t(9),u=t(10),l=t(3),f=t(7),p=t(12),h=t(13),d=t(14);function y(e,r,t,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void t(e)}c.done?r(s):Promise.resolve(s).then(n,o)}function b(e){return function(){var r=this,t=arguments;return new Promise(function(n,o){var a=e.apply(r,t);function i(e){y(a,n,o,i,c,"next",e)}function c(e){y(a,n,o,i,c,"throw",e)}i(void 0)})}}var g={Disabled:0,Disconnected:1,Connected:2,Connecting:3};function v(r,t){var n=Object(h.a)(r),a=n.protocol,y=n.hostname,v=n.port,w=n.path,m=n.err;if(m)throw m;var S=function(e,r,t,n){var o="".concat("https"===e?"wss":"ws","://").concat(r,":").concat(t);return n?"".concat(o).concat(n):o}(a,y,v,w);null==t&&(t={});var E,x=function(e,r,t){var n="".concat(e,":").concat(r);return t?"".concat(n).concat(t):n}(y,v,w);e.browser&&(E=localStorage.getItem(x)),null!=E?(E=JSON.parse(E)).session=new l.a(E.session):E={};var C=t.defaultReqTimeout||6e4,k=t.reconnectionInterval||2e3,R=t.autoconnect||!0,O={},j=E.session?{key:E.session}:null,U=null,P=g.Disconnected,A=null,T=null,I=null,L=6e4,_=t.dialTimeout||6e4,D=function(e){var r=function(){},t=function(){},n=function(){},o=function(){},a=function(){};if(null==e||null==e.handlers)return{onSignal:r,onSessionCreated:t,onSessionClosed:n,onDisconnected:o,onConnected:a};var i=e.handlers;return i.onSignal instanceof Function&&(r=i.onSignal),i.onSessionCreated instanceof Function&&(t=i.onSessionCreated),i.onSessionClosed instanceof Function&&(n=i.onSessionClosed),i.onDisconnected instanceof Function&&(o=i.onDisconnected),i.onConnected instanceof Function&&(a=i.onConnected),{onSignal:r,onSessionCreated:t,onSessionClosed:n,onDisconnected:o,onConnected:a}}(t),q=D.onSignal,F=D.onSessionCreated,N=D.onSessionClosed,B=D.onDisconnected,M=D.onConnected;function z(e){var r=new l.a(e.k);j={key:r,creationDate:new Date(e.c),info:e.i};var t=JSON.stringify({session:r.string});localStorage.setItem(x,t),F({key:r,creationDate:new Date(e.c),info:e.i})}function G(e){var r=O[e.id];r&&r.fail({code:e.error.code,message:e.error.message})}function Z(e){var r=O[e.id];r&&r.fulfill({encoding:e.encoding,payload:e.payload})}function J(e){return V.apply(this,arguments)}function V(){return(V=b(o.a.mark(function e(r){var t,n,a,i,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.size<1)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Object(f.a)(r);case 4:if(t=e.sent,n=t.type,a=t.msg,i=t.payloadEncoding,null==(s=t.err)){e.next=12;break}return console.error("webwire: failed parsing message: ".concat(s)),e.abrupt("return");case 12:e.t0=n,e.next=e.t0===c.b.ReplyBinary?15:e.t0===c.b.ReplyUtf8?15:e.t0===c.b.ReplyUtf16?15:e.t0===c.b.ReplyShutdown?17:e.t0===c.b.ReplyInternalError?17:e.t0===c.b.SessionNotFound?17:e.t0===c.b.MaxSessConnsReached?17:e.t0===c.b.ErrorReply?17:e.t0===c.b.SignalBinary?19:e.t0===c.b.SignalUtf8?19:e.t0===c.b.SignalUtf16?19:e.t0===c.b.SessionCreated?21:e.t0===c.b.SessionClosed?23:25;break;case 15:return Z({id:a.id,encoding:i,payload:a.payload}),e.abrupt("break",27);case 17:return G({id:a.id,error:a.reqError}),e.abrupt("break",27);case 19:return q({name:a.name,encoding:i,payload:a.payload}),e.abrupt("break",27);case 21:return z(a.session),e.abrupt("break",27);case 23:return j=null,N(),e.abrupt("break",27);case 25:return console.warn("webwire: strange message type received:",n),e.abrupt("break",27);case 27:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function W(e){return new Promise(function(r){return setTimeout(r,e)})}function Y(e){return $.apply(this,arguments)}function $(){return($=b(o.a.mark(function e(r){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(P!==g.Connecting){e.next=4;break}return e.abrupt("return",new Promise(function(e,r){T.then(e).catch(r)}));case 4:if(P===g.Disconnected){e.next=6;break}return e.abrupt("return",Promise.resolve());case 6:if(R){e.next=8;break}return e.abrupt("return",ee());case 8:return e.abrupt("return",new Promise(function(e,t){if(null!=A)return r>0&&setTimeout(function(){var r=new Error("Auto-connect attempt timed out");r.errType="timeout",e(r)},r),void A.then(e);A=new Promise(function(){var e=b(o.a.mark(function e(n){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(r>0)){e.next=4;break}return setTimeout(function(){var e=new Error("Auto-reconnect attempt timed out");e.errType="timeout",n(e)},r),e.abrupt("return");case 4:return e.next=7,ee();case 7:if(null!=(a=e.sent)){e.next=14;break}return n(),A=null,e.abrupt("return");case 14:if("disconnected"!==a.errType){e.next=20;break}return e.next=17,W(k);case 17:return e.abrupt("continue",4);case 20:return n({err:a}),A=null,e.abrupt("return");case 23:e.next=4;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(0),t(e.t0);case 30:case"end":return e.stop()}},e,this,[[0,27]])}));return function(r){return e.apply(this,arguments)}}())}));case 9:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function H(e,r,t,n,a){return new Promise(function(){var i=b(o.a.mark(function i(c,u){var l,f,h,d,y,b;return o.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,l=e&&!r?new p.a(e,t):new s.a(r,t,n),f=l.id.bytes,h=a||C,d=setTimeout(function(){delete O[f],d=null;var e=new Error("Request timed out");e.errType="timeout",c({err:e})},h),o.next=7,Y(h);case 7:if(null==(y=o.sent)){o.next=10;break}return o.abrupt("return",c({err:y}));case 10:b={fulfill:function(e){null!=d&&(delete O[f],clearTimeout(d),c({reply:e}))},fail:function(e){null!=d&&(delete O[f],clearTimeout(d),c({err:e}))}},O[f]=b,U.send(l.bytes),X(),o.next=19;break;case 16:o.prev=16,o.t0=o.catch(0),u(o.t0);case 19:case"end":return o.stop()}},i,this,[[0,16]])}));return function(e,r){return i.apply(this,arguments)}}())}function K(e){return Q.apply(this,arguments)}function Q(){return(Q=b(o.a.mark(function e(r){var t,n,a,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H(c.b.RestoreSession,null,r);case 2:if(t=e.sent,n=t.reply,null==(a=t.err)){e.next=10;break}return console.warn("webwire client: couldn't restore session:",a),j=null,localStorage.removeItem(x),e.abrupt("return",a);case 10:i=JSON.parse(n.payload),j={key:new l.a(i.k),creationDate:new Date(i.c),info:i.i};case 12:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function X(){clearInterval(I),I=setInterval(function(){var e=new ArrayBuffer(1),r=new Uint8Array(e,0,1);r[0]=c.b.Heartbeat;try{U.send(r)}catch(e){console.error("couldn't send heartbeat message: ",m)}},L)}function ee(){return P===g.Connected?Promise.resolve():null!=T?new Promise(function(e,r){T.then(e).catch(r)}):T=new Promise(function(){var e=b(o.a.mark(function e(r,t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:P=g.Connecting;try{n=setTimeout(function(){if(P!=g.Connected){T=null,console.error("webwire dial timeout error:",m);var e=new Error("dial timeout error");e.errType="dialTimeout",r(e)}},_),(U=new i.a(S)).onError(function(e){clearTimeout(n),T=null,console.error("webwire client error:",e);var t=new Error("WebSocket error: ".concat(e));t.errType="disconnected",r(t)}),U.onMessage(function(){var e=b(o.a.mark(function e(t){var a,i,s,u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(n),e.next=3,Object(f.a)(t);case 3:if((a=e.sent).type==c.b.AcceptConf){e.next=10;break}return T=null,console.error("webwire protocol error:",u),(i=new Error("webwire protocol error: expected the server to send an accept-conf "+" message, got: ".concat(a.type))).errType="protocolError",e.abrupt("return",r(i));case 10:if(!(s=!Object(d.a)(a.majorProtocolVersion,a.minorProtocolVersion))){e.next=13;break}return e.abrupt("return",r(s));case 13:if(a.messageBufferSize,L=a.readTimeout-a.readTimeout/4,U.onMessage(function(e){return J(e)}),T=null,P=g.Connected,X(),null!=j){e.next=22;break}return M(),e.abrupt("return",r());case 22:return e.next=24,K(j.key.bytes);case 24:null!=(u=e.sent)&&console.warn("webwire: couldn't restore session on reconnection",u),M(),r();case 28:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}()),U.onClose(function(){var e=b(o.a.mark(function e(r){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P=g.Disconnected,1e3!==r&&1001!==r&&console.warn("webwire: abnormal closure error code:",r),clearInterval(I),I=null,B(),e.next=6,Y(0);case 6:null!=(t=e.sent)&&console.error("webwire: autoconnect failed:",t);case 8:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}())}catch(e){t(e)}case 2:case"end":return e.stop()}},e,this)}));return function(r,t){return e.apply(this,arguments)}}())}function re(){return(re=b(o.a.mark(function e(r,t,n){var a,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new u.a(r,t,n),e.next=3,ee();case 3:if(null==(i=e.sent)){e.next=6;break}return e.abrupt("return",i);case 6:U.send(a.bytes),X();case 8:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function te(){return(te=b(o.a.mark(function e(r){var t,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r instanceof l.a){e.next=2;break}return e.abrupt("return",new Error("Expected session key to be an instance of SessionKey"));case 2:if(!j){e.next=4;break}return e.abrupt("return",new Error("Can't restore session if another one is already active"));case 4:return e.next=6,ee();case 6:if(null==(t=e.sent)){e.next=9;break}return e.abrupt("return",t);case 9:return e.next=11,K(r.bytes);case 11:null!=(n=e.sent)&&console.warn("webwire: couldn't restore session by key\n\t\t\t\t\t(".concat(r.string,") : ").concat(n));case 13:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function ne(){return(ne=b(o.a.mark(function e(){var r,t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(j&&!(P<g.Connected)){e.next=3;break}return j=null,e.abrupt("return");case 3:return e.next=5,H(c.b.CloseSession);case 5:if(r=e.sent,null==(t=r.err)){e.next=9;break}return e.abrupt("return",t);case 9:j=null,localStorage.removeItem(x);case 11:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}Object.defineProperty(this,"connect",{value:ee}),Object.defineProperty(this,"request",{value:function(e,r,t,n){return H(null,e,r,t,n)}}),Object.defineProperty(this,"signal",{value:function(e,r,t){return re.apply(this,arguments)}}),Object.defineProperty(this,"restoreSession",{value:function(e){return te.apply(this,arguments)}}),Object.defineProperty(this,"closeSession",{value:function(){return ne.apply(this,arguments)}}),Object.defineProperty(this,"close",{value:function(){U.close(),U=null,P=g.Disabled}}),Object.defineProperty(this,"status",{get:function(){switch(P){case g.Disabled:return"disabled";case g.Disconnected:return"disconnected";case g.Connected:return"connected";case g.Connecting:return"connecting"}return"invalid_client_status"}}),Object.defineProperty(this,"session",{get:function(){if(j)return{key:j.key,creationDate:j.creationDate?new Date(j.creationDate.getTime()):null,info:j.info?JSON.parse(JSON.stringify(j.info)):null}}}),Object.defineProperty(this,"pendingRequests",{get:function(){return O.length}}),Object.freeze(this),Y(0).then(function(e){null!=e&&console.error("webwire: autoconnect failed:",e)}).catch(function(e){console.warn("webwire: autoconnect failed:",e)})}}.call(this,t(6))},function(e,r,t){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,a=o&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=t(17),o)n.regeneratorRuntime=a;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,r){!function(r){"use strict";var t,n=Object.prototype,o=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag",u="object"==typeof e,l=r.regeneratorRuntime;if(l)u&&(e.exports=l);else{(l=r.regeneratorRuntime=u?e.exports:{}).wrap=m;var f="suspendedStart",p="suspendedYield",h="executing",d="completed",y={},b={};b[i]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(A([])));v&&v!==n&&o.call(v,i)&&(b=v);var w=C.prototype=E.prototype=Object.create(b);x.prototype=w.constructor=C,C.constructor=x,C[s]=x.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var r="function"==typeof e&&e.constructor;return!!r&&(r===x||"GeneratorFunction"===(r.displayName||r.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,C):(e.__proto__=C,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(w),e},l.awrap=function(e){return{__await:e}},k(R.prototype),R.prototype[c]=function(){return this},l.AsyncIterator=R,l.async=function(e,r,t,n){var o=new R(m(e,r,t,n));return l.isGeneratorFunction(r)?o:o.next().then(function(e){return e.done?e.value:o.next()})},k(w),w[s]="Generator",w[i]=function(){return this},w.toString=function(){return"[object Generator]"},l.keys=function(e){var r=[];for(var t in e)r.push(t);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},l.values=A,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(U),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,r){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=r&&r<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=r,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,r){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&r&&(this.next=r),y},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),U(t),y}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.tryLoc===e){var n=t.completion;if("throw"===n.type){var o=n.arg;U(t)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}}}function m(e,r,t,n){var o=r&&r.prototype instanceof E?r:E,a=Object.create(o.prototype),i=new P(n||[]);return a._invoke=function(e,r,t){var n=f;return function(o,a){if(n===h)throw new Error("Generator is already running");if(n===d){if("throw"===o)throw a;return T()}for(t.method=o,t.arg=a;;){var i=t.delegate;if(i){var c=O(i,t);if(c){if(c===y)continue;return c}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if(n===f)throw n=d,t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);n=h;var s=S(e,r,t);if("normal"===s.type){if(n=t.done?d:p,s.arg===y)continue;return{value:s.arg,done:t.done}}"throw"===s.type&&(n=d,t.method="throw",t.arg=s.arg)}}}(e,t,i),a}function S(e,r,t){try{return{type:"normal",arg:e.call(r,t)}}catch(e){return{type:"throw",arg:e}}}function E(){}function x(){}function C(){}function k(e){["next","throw","return"].forEach(function(r){e[r]=function(e){return this._invoke(r,e)}})}function R(e){var r;this._invoke=function(t,n){function a(){return new Promise(function(r,a){!function r(t,n,a,i){var c=S(e[t],e,n);if("throw"!==c.type){var s=c.arg,u=s.value;return u&&"object"==typeof u&&o.call(u,"__await")?Promise.resolve(u.__await).then(function(e){r("next",e,a,i)},function(e){r("throw",e,a,i)}):Promise.resolve(u).then(function(e){s.value=e,a(s)},function(e){return r("throw",e,a,i)})}i(c.arg)}(t,n,r,a)})}return r=r?r.then(a,a):a()}}function O(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method))return y;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var o=S(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,y;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function j(e){var r={tryLoc:e[0]};1 in e&&(r.catchLoc=e[1]),2 in e&&(r.finallyLoc=e[2],r.afterLoc=e[3]),this.tryEntries.push(r)}function U(e){var r=e.completion||{};r.type="normal",delete r.arg,e.completion=r}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function A(e){if(e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function r(){for(;++n<e.length;)if(o.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:T}}function T(){return{value:t,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())}])});